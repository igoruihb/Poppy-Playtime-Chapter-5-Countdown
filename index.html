<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Poppy Playtime Chapter 5 - Broken Things</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        :root { --blood-red: #8b0000; --bright-red: #ff0000; --glitch-cyan: #00ffff; }
        body, html { height: 100%; margin: 0; background-color: #000; font-family: 'Press Start 2P', cursive; color: white; overflow: hidden; }
        
        /* Background & Overlays */
        .main-bg { background-image: url('image_c53efb.jpg'); background-size: cover; background-position: center; height: 115vh; width: 115vw; position: fixed; top: -7%; left: -7%; z-index: 1; transition: all 0.5s ease; filter: brightness(0.6); }
        .vignette { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: radial-gradient(circle, transparent 40%, black 150%); z-index: 5; pointer-events: none; }
        .strobe { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--blood-red); z-index: 7; opacity: 0; pointer-events: none; mix-blend-mode: overlay; }
        #flashbang-overlay { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: white; z-index: 100000; opacity: 0; pointer-events: none; transition: opacity 0.1s; }
        
        /* UI Layout */
        .overlay-content { position: relative; height: 100vh; display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 10; text-align: center; }
        #header-area { transition: all 0.5s; min-height: 120px; display: flex; flex-direction: column; align-items: center; justify-content: center; width: 95%; opacity: 0.4; }
        
        /* The Big Numbers */
        .timer { font-size: 6rem; text-shadow: 4px 4px 0px var(--blood-red); margin: 20px 0; transition: all 0.3s; transform: scale(1); }
        
        /* Cinematic Intensity States */
        .cinematic-intense .main-bg { animation: cinematic-zoom 10s infinite alternate; filter: brightness(0.4) contrast(1.5); }
        .cinematic-intense .timer { color: var(--bright-red); transform: scale(1.3); }
        
        .cinematic-more-intense .main-bg { animation: cinematic-zoom-shake 0.15s infinite; filter: brightness(0.3) contrast(2); }
        .cinematic-more-intense .timer { transform: scale(1.8); animation: text-glitch 0.1s infinite; }
        .cinematic-more-intense .strobe { animation: strobe-fast 0.1s infinite; }

        /* End State UI */
        #release-group { display: none; flex-direction: column; align-items: center; gap: 20px; z-index: 100; }
        .out-now-text { font-size: 4rem; color: var(--bright-red); text-shadow: 5px 5px 0px white; animation: text-glitch 0.2s infinite; }
        
        .pp-btn { padding: 20px 30px; font-family: 'Press Start 2P'; font-size: 14px; color: white; border: 3px solid white; background: rgba(0,0,0,0.7); transition: 0.3s; cursor: pointer; text-decoration: none; display: inline-block; }
        .pp-btn:hover { background: white; color: black; box-shadow: 0 0 30px white; }

        /* Animation Keyframes */
        @keyframes cinematic-zoom { from { transform: scale(1); } to { transform: scale(1.2); } }
        @keyframes cinematic-zoom-shake { 
            0%, 100% { transform: translate(0,0) scale(1.2); }
            25% { transform: translate(8px, -8px) scale(1.22); }
            50% { transform: translate(-8px, 8px) scale(1.2); }
        }
        @keyframes strobe-fast { 0%, 100% { opacity: 0; } 50% { opacity: 0.4; } }
        @keyframes text-glitch { 0% { transform: translate(4px, 0); } 50% { text-shadow: -5px 0 var(--glitch-cyan); } 100% { transform: translate(0,0); } }
        @keyframes peek-out { 0% { left: -600px; } 20%, 80% { left: 0; } 100% { left: -600px; } }
        @keyframes fall { to { transform: translateY(110vh); } }

        /* Sprites & Mobile */
        .huggy-sprite { position: fixed; width: 120px; z-index: 9; pointer-events: none; }
        .drop { position: fixed; top: -50px; width: 3px; height: 35px; background: var(--bright-red); z-index: 99; pointer-events: none; animation: fall linear forwards; }
        
        @media (max-width: 600px) {
            .timer { font-size: 2.2rem; }
            .out-now-text { font-size: 1.8rem; }
            #header-area { font-size: 0.6rem; opacity: 0.5; }
        }

        /* Admin/Chat UI */
        #chat-container { position: fixed; right: 20px; bottom: 20px; width: 280px; height: 320px; background: rgba(0,0,0,0.85); border: 2px solid #222; z-index: 1000; display: none; flex-direction: column; font-size: 8px; }
        #chat-messages { flex-grow: 1; overflow-y: auto; padding: 10px; display: flex; flex-direction: column; gap: 8px; scrollbar-width: none; }
        #chat-input { background: #111; border: none; border-top: 1px solid #333; color: white; padding: 12px; font-family: 'Press Start 2P'; font-size: 8px; outline: none; }
        #admin-box { position: fixed; top: -150px; left: 50%; transform: translateX(-50%); width: 450px; background: rgba(0,0,0,0.95); border: 3px solid var(--glitch-cyan); padding: 20px; z-index: 10000; transition: top 0.4s; text-align: center; }
        #admin-box.open { top: 30px; }
        #admin-input { width: 90%; background: #000; border: 1px solid #fff; color: var(--glitch-cyan); font-family: 'Press Start 2P'; padding: 10px; font-size: 10px; outline: none; }
    </style>
</head>
<body id="b">
    <audio id="bgMusic" loop><source src="poppy.mp3" type="audio/mpeg"></audio>
    <div id="flashbang-overlay"></div>
    <div class="main-bg"></div>
    <div class="vignette"></div>
    <div class="strobe"></div>
    <img src="prototype.png" id="prototype-img" style="position: fixed; left: -600px; top: 25%; width: 450px; z-index: 9; pointer-events: none;">
    
    <div id="admin-box"><input type="text" id="admin-input" placeholder="CMD OR MSG"></div>
    
    <div id="start-screen" style="position:fixed; z-index:99999; width:100%; height:100%; display:flex; justify-content:center; align-items:center; background:black;">
        <button id="start-btn" class="pp-btn" style="font-size: 16px;">ENTER THE FINAL COUNTDOWN</button>
    </div>

    <div id="chat-container">
        <div id="chat-messages"></div>
        <input type="text" id="chat-input" placeholder="TYPE..." maxlength="50">
    </div>

    <div id="main-content" class="overlay-content" style="display:none;">
        <div id="header-area">
            <div style="letter-spacing: 5px;">POPPY PLAYTIME: CHAPTER 5</div>
            <div id="sub-header" style="font-size: 0.8rem; color: var(--bright-red); margin-top: 10px;">BROKEN THINGS</div>
        </div>
        
        <div id="countdown" class="timer">--:--:--</div>

        <div id="release-group">
            <div class="out-now-text">OUT NOW</div>
            <a href="https://store.steampowered.com/app/4100940/Poppy_Playtime__Chapter_5/" target="_blank" class="pp-btn">DOWNLOAD GAME</a>
            <a href="https://www.youtube.com/watch?v=bfu4BrHygzs" target="_blank" class="pp-btn" style="border-color: #ff0000; margin-top: 10px;">WATCH KREEEKCRAFT BEAT IT</a>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyDEYwkfnrJM-FAmpOzlg7W6hfJIGG61QY8",
            authDomain: "poppy-playtime-5-countdown.firebaseapp.com",
            databaseURL: "https://poppy-playtime-5-countdown-default-rtdb.firebaseio.com",
            projectId: "poppy-playtime-5-countdown"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        let rainInt, huggyInt;
        let myUser = "Subject-" + Math.floor(Math.random()*999);

        document.getElementById('start-btn').onclick = () => {
            document.getElementById('bgMusic').play().catch(()=>{});
            document.getElementById('start-screen').style.display = 'none';
            document.getElementById('main-content').style.display = 'flex';
            document.getElementById('chat-container').style.display = 'flex';
        };

        const target = new Date("Feb 18, 2026 18:00:00 GMT+0100").getTime();
        const countdownEl = document.getElementById('countdown');
        const releaseGroup = document.getElementById('release-group');
        const headerArea = document.getElementById('header-area');
        const bodyEl = document.getElementById('b');

        setInterval(() => {
            const diff = target - new Date().getTime();

            if(diff <= 0) { 
                countdownEl.style.display = 'none';
                headerArea.style.display = 'none';
                releaseGroup.style.display = 'flex';
                bodyEl.classList.remove('cinematic-intense', 'cinematic-more-intense');
                return; 
            }

            const d = Math.floor(diff / 86400000);
            const h = Math.floor((diff % 86400000) / 3600000);
            const m = Math.floor((diff % 3600000) / 60000);
            const s = Math.floor((diff % 60000) / 1000);

            let parts = [];
            if (d > 0) parts.push(d);
            if (d > 0 || h > 0) parts.push(h.toString().padStart(2, '0'));
            if (d > 0 || h > 0 || m > 0) parts.push(m.toString().padStart(2, '0'));
            parts.push(s.toString().padStart(2, '0'));
            
            countdownEl.innerText = parts.join(':');

            if (diff < 10000) { 
                bodyEl.classList.add('cinematic-more-intense');
                bodyEl.classList.remove('cinematic-intense');
            } else if (diff < 60000) { 
                bodyEl.classList.add('cinematic-intense');
                bodyEl.classList.remove('cinematic-more-intense');
            }
        }, 1000);

        // Events & Admin Logic
        function processInput(upper, original) {
            if (upper === "FLASHBANG") {
                const f = document.getElementById('flashbang-overlay');
                f.style.opacity = '1';
                setTimeout(() => f.style.opacity = '0', 3000);
            } else if (upper === "BLOOD RAIN") {
                startRain();
            } else if (upper === "HUGGY CHAOS") {
                startHuggyChaos();
            } else if (upper === "PROTOTYPE") {
                const p = document.getElementById('prototype-img');
                p.style.animation = 'peek-out 4s forwards';
                setTimeout(() => p.style.animation = '', 4100);
            } else {
                headerArea.innerHTML = `<div style="color:var(--glitch-cyan); opacity: 1;">[ADMIN]: ${original}</div>`;
                headerArea.style.opacity = "1";
            }
        }

        function reset() {
            clearInterval(rainInt); clearInterval(huggyInt);
            document.querySelectorAll('.drop, .huggy-sprite').forEach(e => e.remove());
            headerArea.style.opacity = "0.4";
            headerArea.innerHTML = `<div style="letter-spacing: 5px;">POPPY PLAYTIME: CHAPTER 5</div><div style="font-size: 0.8rem; color: var(--bright-red); margin-top: 10px;">BROKEN THINGS</div>`;
        }

        function startRain() {
            clearInterval(rainInt);
            rainInt = setInterval(() => {
                const d = document.createElement('div'); d.className = 'drop';
                d.style.left = Math.random()*100+'vw';
                document.body.appendChild(d); setTimeout(() => d.remove(), 1000);
            }, 60);
        }

        function startHuggyChaos() {
            clearInterval(huggyInt);
            huggyInt = setInterval(() => {
                const h = document.createElement('img'); h.src = 'Huggy.png'; h.className = 'huggy-sprite';
                h.style.top = Math.random()*80+'%'; h.style.left = Math.random()*80+'%';
                document.body.appendChild(h); setTimeout(() => h.remove(), 2000);
            }, 400);
        }

        // Global Listeners
        db.ref('globalMessage').on('value', (s) => {
            const val = s.val();
            val ? processInput(val.toUpperCase(), val) : reset();
        });

        const chatIn = document.getElementById('chat-input');
        chatIn.onkeydown = (e) => {
            if(e.key === 'Enter' && chatIn.value.trim()){
                db.ref('chat').push({ user: myUser, text: chatIn.value });
                chatIn.value = '';
            }
        };

        db.ref('chat').limitToLast(12).on('child_added', (s) => {
            const d = s.val();
            const msg = document.createElement('div');
            msg.innerHTML = `<span style="color:var(--glitch-cyan)">${d.user}:</span> ${d.text}`;
            const box = document.getElementById('chat-messages');
            box.appendChild(msg);
            box.scrollTop = box.scrollHeight;
        });

        window.onkeydown = (e) => {
            if(e.key === 'F2') {
                document.getElementById('admin-box').classList.toggle('open');
                document.getElementById('admin-input').focus();
            }
        };

        document.getElementById('admin-input').onkeydown = (e) => {
            if(e.key === 'Enter') {
                db.ref('globalMessage').set(e.target.value.toUpperCase() === "RESET" ? null : e.target.value);
                e.target.value = '';
                document.getElementById('admin-box').classList.remove('open');
            }
        };
    </script>
</body>
</html>
